<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <title>Dices</title>
    <section class="hero is-primary">
        <div class="hero-body">
            <p class="title">
                Dice Roller
            </p>
            <p class="subtitle">
                I know that you forgot your cubes)
            </p>
        </div>
    </section>
</head>
<body>
<style>
    .select{
        position: center;
    }
    .section{
        padding: 1rem;
    }
    .countButtons{
        padding: 15px;
        position: center;
    }
    .input{
        width: 300px;
        font-size: 120%;
        border-color: #2ecc71;
        border-radius: 10px;
    }

    .button.is-large {
        font-size: 2rem;
    }

    .diceRequest{
        padding: 20px;
        color: #048aa9;
        font-size: 250%;
    }
    .diceResult{
        color: #00b89c;
        font-size: 750%;
    }

    .historyListEmpty{
        font-size: 200%;
        color: #00b89c;
        text-align: center;
    }

    .historyListStyle{
        font-size: 200%;
        color: #00b89c;
    }

    .tabs .tab a {
        color: whitesmoke;
        font-size: 110%;
    }

    .tabs .tab a:hover {
        color: #00b89c;
        background-color: whitesmoke;
        /*Custom Color On Hover*/
    }

    .tabs .tab a:focus.active {
        color: #1eab9e;
        /*Custom Text Color While Active*/
        background-color: rgba(38, 166, 154, 0.2);
        /*Custom Background Color While Active*/
    }
    .tabs li.is-active a {
        color: #1eab9e;
        background-color: whitesmoke;
    }

    .tabs .indicator {
        color: #2c2b2b;
        background-color: #30aba0;
        /*Custom Color Of Indicator*/
    }

</style>
    <nav class="tabs is-boxed has-background-primary is-centered">
        <div class="container">
            <ul>
                <li class="tab is-active" onclick="openTab(event,'rollPage')"><a >One Dice Roll</a></li>
                <li class="tab" onclick="openTab(event,'multiRollPage')"><a >Multi Dice Roll</a></li>
                <li class="tab" onclick="openTab(event,'historyPage')"><a >History</a></li>
            </ul>
        </div>
    </nav>
    <div class="container section" >
        <div id="rollPage" class="content-tab">
            <center>
                <label class="historyListStyle">Dice Type: </label>
                <div class="select is-primary">
                    <label>
                        <select name="diceID1" class="is-focused">
                            <option>D4</option>
                            <option>D6</option>
                            <option>D8</option>
                            <option>D10</option>
                            <option>D12</option>
                            <option>D20</option>
                            <option>D100</option>
                        </select>
                    </label>
                </div>

                <div style="padding: 1rem">
                    <button class="button is-primary is-large" id="rollOne" onclick="getDiceResult1()">Roll</button>
                </div>
                <div>
                    <label class="diceRequest" id="diceRequest1">Roll Info</label>
                </div>
                <div>
                    <label class="diceResult" id="diceResult1">Result</label>
                </div>

                <script>
                    function selectDice1(){
                        var s = document.getElementsByName('diceID1')[0];
                        s.addEventListener("change", selectDice);
                        return s.options[s.selectedIndex].value
                    }

                    var count = 1;
                    function getDiceResult1() {
                        const xhr = new XMLHttpRequest();
                        xhr.open("GET", `${window.location.protocol}//${window.location.hostname}:${window.location.port}/api/v1/roll?dice_name=${selectDice1()}&count=1`);
                        xhr.onload = () => {
                            if (xhr.readyState === 4 && xhr.status === 200) {
                                let data = JSON.stringify(JSON.parse(xhr.response));
                                console.log(data)

                                document.getElementById("clearHistoryButton").style.display = "block";
                                document.getElementById("historyEmpty").innerHTML = "";
                                document.getElementById("historyList").innerHTML =count++ +". "+"1x"+ selectDice1()
                                    + " Result: " + JSON.parse(data)["total"] + "<br>" + document.getElementById("historyList").innerHTML;
                                document.getElementById("diceRequest1").innerHTML ="1x"+ selectDice1();
                                document.getElementById("diceResult1").innerHTML = JSON.parse(data)["total"];
                            } else {
                                console.log(`Error: ${xhr.status}`);
                            }
                        };
                        xhr.send();
                    }
                </script>
            </center>
        </div>
        <div id="multiRollPage" class="content-tab" style="display:none">
            <center>
                <label class="historyListStyle">Dice Count: </label>
                <div class="countButtons">
                    <div>
                        <button class="button is-primary" onclick="plus(1)">+1</button>
                        <button class="button is-primary" onclick="plus(10)">+10</button>
                        <button class="button is-primary" onclick="plus(100)">+100</button>
                        <button class="button is-primary" onclick="plus(1000)">+1000</button>
                    </div>
                    <div>
                        <label for="number"></label><input class="input is-primary" type="number" id="number" maxlength="3"  min="1" value="1" style="text-align:center"/>
                    </div>
                    <div>
                        <button class="button is-primary" onclick="minus(1)">-1</button>
                        <button class="button is-primary" onclick="minus(10)">-10</button>
                        <button class="button is-primary" onclick="minus(100)">-100</button>
                        <button class="button is-primary" onclick="minus(1000)">-1000</button>
                    </div>
                </div>
                <label class="historyListStyle">Dice Type: </label>
                <div class="select is-primary">
                    <label>
                        <select name="diceID" class="is-focused">
                            <option>D4</option>
                            <option>D6</option>
                            <option>D8</option>
                            <option>D10</option>
                            <option>D12</option>
                            <option>D20</option>
                            <option>D100</option>
                        </select>
                    </label>
                </div>
                <div style="padding: 1rem">
                    <button class="button is-primary is-large" onclick="getDiceResult()" >Roll</button>
                </div>
                <div>
                    <label class="diceRequest" id="diceRequest">Roll Info</label>
                </div>
                <div>
                    <label class="diceResult" id="diceResult">Result</label>
                </div>
                <script>
                    document.getElementById('number').readOnly = true;
                    function selectDice(){
                        var s = document.getElementsByName('diceID')[0];
                        s.addEventListener("change", selectDice);
                        return s.options[s.selectedIndex].value
                    }
                    function diceCount() {
                        var count = document.getElementById('number').value
                        return count
                    }

                    function textSizing() {
                        if ( document.getElementById('number').value >= 1000){
                            if (selectDice() === "D20" || selectDice() === "D100"){
                                document.getElementById("diceResult").style.fontSize = "750%";
                            }else {
                                document.getElementById("diceResult").style.fontSize = "900%";
                            }
                        }
                        if ( document.getElementById('number').value >= 3000){
                            if (selectDice() === "D20" || selectDice() === "D100"){
                                document.getElementById("diceResult").style.fontSize = "550%";
                            }else {
                                document.getElementById("diceResult").style.fontSize = "700%";
                            }        }
                        if ( document.getElementById('number').value >= 40000){
                            document.getElementById("diceResult").style.fontSize = "550%";
                        }
                    }
                    var count = 1;
                    function getDiceResult() {
                        const xhr = new XMLHttpRequest();
                        xhr.open("GET", `${window.location.protocol}//${window.location.hostname}:${window.location.port}/api/v1/roll?dice_name=${selectDice()}&count=${diceCount()}`);
                        xhr.onload = () => {
                            if (xhr.readyState === 4 && xhr.status === 200) {
                                let data = JSON.stringify(JSON.parse(xhr.response));
                                console.log(data)
                                textSizing()
                                document.getElementById("historyEmpty").innerHTML = "";
                                document.getElementById("clearHistoryButton").style.display = "block";
                                document.getElementById("historyList").innerHTML =count++ +". "+ diceCount()+"x"+ selectDice()
                                    + " Result: " + JSON.parse(data)["total"] + "<br>" + document.getElementById("historyList").innerHTML;
                                document.getElementById("diceRequest").innerHTML = diceCount() +"x"+ selectDice();
                                document.getElementById("diceResult").innerHTML = JSON.parse(data)["total"];
                            } else {
                                console.log(`Error: ${xhr.status}`);
                            }
                        };
                        xhr.send();
                    }

                    function plus(count){
                        let value = parseInt(document.getElementById('number').value, 10);
                        value = isNaN(value) ? 0 : value;
                        value += count ;
                        if (value >= 40000) {
                            value = 40000
                        }
                        document.getElementById('number').value = value;
                    }
                    function minus(count){
                        let value = parseInt(document.getElementById('number').value, 10);
                        value = isNaN(value) ? 0 : value;
                        value -= count ;
                        if (value <= 1) {
                            value = 1
                        }
                        document.getElementById('number').value = value;
                    }
                </script>
            </center>
        </div>
        <div id="historyPage" class="content-tab" style="display:none">
            <p class ="historyListEmpty" id="historyEmpty" > You haven't rolled the dice yet.</p>
            <div style="padding-bottom: 20px">
                <button class="button is-primary" id="clearHistoryButton" style="display: none" onclick="clearHistoryList()">Clear</button>
            </div>
            <p class ="historyListStyle" id="historyList"></p>
        </div>
        <script>
            function clearHistoryList() {
                document.getElementById("historyList").innerHTML = "";
            }
        </script>
    </div>
</body>
<script>
    function openTab(evt, tabName) {
        var i, x, tablinks;
        x = document.getElementsByClassName("content-tab");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab");
        for (i = 0; i < x.length; i++) {
            tablinks[i].className = tablinks[i].className.replace("is-active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " is-active";
    }
</script>
</html>